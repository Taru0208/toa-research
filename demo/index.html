---
layout: null
---
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Feel the Difference — Theory of Anticipation Interactive Demo</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: #0f1117;
  color: #e0e0e0;
  min-height: 100vh;
}

.header {
  text-align: center;
  padding: 2rem 1rem 1rem;
  border-bottom: 1px solid #2a2d3a;
}
.header h1 { font-size: 1.6rem; color: #fff; margin-bottom: 0.3rem; }
.header p { color: #888; font-size: 0.9rem; }

.tabs {
  display: flex;
  justify-content: center;
  gap: 0.5rem;
  padding: 1rem;
  flex-wrap: wrap;
}
.tab {
  padding: 0.5rem 1.2rem;
  border: 1px solid #2a2d3a;
  border-radius: 6px;
  cursor: pointer;
  background: transparent;
  color: #888;
  font-size: 0.85rem;
  transition: all 0.2s;
}
.tab:hover { border-color: #555; color: #ccc; }
.tab.active { border-color: #6c8cff; color: #6c8cff; background: #1a1d2e; }

.game-container { display: none; padding: 1rem; max-width: 900px; margin: 0 auto; }
.game-container.active { display: block; }

/* Battle game styles */
.battle-area {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  gap: 1rem;
  align-items: start;
  margin-bottom: 1.5rem;
}
.fighter {
  background: #1a1d2e;
  border-radius: 10px;
  padding: 1.2rem;
  text-align: center;
}
.fighter.player { border: 1px solid #4a6fa5; }
.fighter.enemy { border: 1px solid #a54a4a; }
.fighter h3 { font-size: 1rem; margin-bottom: 0.8rem; }
.fighter .hp-bar {
  height: 12px;
  background: #2a2d3a;
  border-radius: 6px;
  overflow: hidden;
  margin: 0.4rem 0;
}
.fighter .hp-fill {
  height: 100%;
  border-radius: 6px;
  transition: width 0.4s ease;
}
.fighter.player .hp-fill { background: linear-gradient(90deg, #4a6fa5, #6c8cff); }
.fighter.enemy .hp-fill { background: linear-gradient(90deg, #a54a4a, #ff6c6c); }
.fighter .hp-text { font-size: 0.85rem; color: #888; }
.fighter .rage-bar {
  height: 6px;
  background: #2a2d3a;
  border-radius: 3px;
  overflow: hidden;
  margin: 0.3rem 0;
}
.fighter .rage-fill {
  height: 100%;
  border-radius: 3px;
  background: linear-gradient(90deg, #ff8c00, #ffcc00);
  transition: width 0.4s ease;
}
.fighter .rage-text { font-size: 0.75rem; color: #ff8c00; }

.vs-divider {
  display: flex;
  align-items: center;
  font-size: 1.2rem;
  color: #555;
  font-weight: bold;
  padding-top: 2rem;
}

.battle-log {
  background: #12141c;
  border: 1px solid #2a2d3a;
  border-radius: 8px;
  padding: 0.8rem;
  height: 140px;
  overflow-y: auto;
  font-size: 0.8rem;
  line-height: 1.5;
  margin-bottom: 1rem;
}
.battle-log .log-entry { padding: 2px 0; }
.battle-log .crit { color: #ffcc00; font-weight: bold; }
.battle-log .hit { color: #6c8cff; }
.battle-log .damage { color: #ff6c6c; }
.battle-log .system { color: #888; font-style: italic; }

.action-buttons {
  display: flex;
  justify-content: center;
  gap: 0.8rem;
  margin-bottom: 1rem;
}
.btn {
  padding: 0.7rem 2rem;
  border: none;
  border-radius: 8px;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 500;
}
.btn-fight {
  background: linear-gradient(135deg, #4a6fa5, #6c8cff);
  color: #fff;
}
.btn-fight:hover { transform: scale(1.05); }
.btn-fight:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
.btn-reset {
  background: #2a2d3a;
  color: #888;
}
.btn-reset:hover { background: #3a3d4a; color: #ccc; }

/* ToA analysis panel */
.analysis-panel {
  background: #1a1d2e;
  border: 1px solid #2a2d3a;
  border-radius: 10px;
  padding: 1.2rem;
  margin-top: 1rem;
}
.analysis-panel h3 {
  font-size: 0.95rem;
  margin-bottom: 0.8rem;
  color: #6c8cff;
}
.gds-display {
  display: flex;
  justify-content: center;
  gap: 2rem;
  margin: 1rem 0;
}
.gds-card {
  text-align: center;
  padding: 0.8rem 1.5rem;
  border-radius: 8px;
  background: #12141c;
  min-width: 120px;
}
.gds-card .label { font-size: 0.75rem; color: #888; margin-bottom: 0.3rem; }
.gds-card .value { font-size: 1.8rem; font-weight: bold; }
.gds-card .value.highlight { color: #6c8cff; }
.gds-card .sub { font-size: 0.7rem; color: #666; margin-top: 0.2rem; }

.bar-chart {
  display: flex;
  align-items: flex-end;
  gap: 0.4rem;
  height: 100px;
  margin: 1rem 0;
  padding: 0 1rem;
}
.bar-group {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.2rem;
}
.bar {
  width: 100%;
  max-width: 40px;
  border-radius: 3px 3px 0 0;
  transition: height 0.5s ease;
}
.bar.a1 { background: #6c8cff; }
.bar.a2 { background: #ff8c00; }
.bar.a3 { background: #4ecdc4; }
.bar-label { font-size: 0.65rem; color: #666; }

.explanation {
  font-size: 0.8rem;
  color: #999;
  line-height: 1.6;
  margin-top: 0.8rem;
  padding: 0.8rem;
  background: #12141c;
  border-radius: 6px;
  border-left: 3px solid #6c8cff;
}

/* Comparison mode */
.comparison {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}
.comparison > div {
  background: #1a1d2e;
  border-radius: 10px;
  padding: 1rem;
  border: 1px solid #2a2d3a;
}
.comparison .game-title {
  text-align: center;
  font-size: 0.9rem;
  font-weight: bold;
  margin-bottom: 0.8rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid #2a2d3a;
}

/* Slot machine */
.slot-area {
  text-align: center;
  max-width: 400px;
  margin: 0 auto;
}
.slot-display {
  display: flex;
  justify-content: center;
  gap: 0.5rem;
  margin: 1.5rem 0;
}
.slot-reel {
  width: 70px;
  height: 70px;
  background: #12141c;
  border: 2px solid #2a2d3a;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  transition: all 0.3s;
}
.slot-reel.spinning { animation: spin-pulse 0.2s infinite; border-color: #ff8c00; }
.slot-reel.win { border-color: #4ecdc4; background: #1a2d2a; }
@keyframes spin-pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}
.slot-result {
  font-size: 1.2rem;
  margin: 0.5rem 0;
  min-height: 1.8rem;
}
.slot-result.win { color: #4ecdc4; }
.slot-result.lose { color: #ff6c6c; }
.slot-stats {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 0.5rem;
  margin: 1rem 0;
  font-size: 0.8rem;
}
.slot-stat { background: #12141c; padding: 0.5rem; border-radius: 6px; }
.slot-stat .val { font-size: 1.1rem; font-weight: bold; color: #fff; }

/* Current state indicator */
.state-indicator {
  text-align: center;
  font-size: 0.75rem;
  color: #555;
  padding: 0.3rem;
  background: #12141c;
  border-radius: 4px;
  margin-top: 0.5rem;
  font-family: monospace;
}

/* Responsive */
@media (max-width: 640px) {
  .comparison { grid-template-columns: 1fr; }
  .battle-area { grid-template-columns: 1fr; }
  .vs-divider { justify-content: center; padding: 0; }
  .gds-display { flex-direction: column; align-items: center; }
}

.footer {
  text-align: center;
  padding: 2rem;
  color: #555;
  font-size: 0.75rem;
}
.footer a { color: #6c8cff; text-decoration: none; }
</style>
</head>
<body>

<div class="header">
  <h1>Feel the Difference</h1>
  <p>Play games. See why one feels better. Theory of Anticipation explains.</p>
</div>

<div class="tabs">
  <button class="tab active" onclick="switchTab('battle')">Battle: Standard vs Enhanced</button>
  <button class="tab" onclick="switchTab('slots')">Slots vs Coin Flip</button>
</div>

<!-- ============ BATTLE TAB ============ -->
<div id="tab-battle" class="game-container active">

  <div class="comparison">
    <!-- Standard Battle -->
    <div id="game-standard">
      <div class="game-title">Standard Battle</div>
      <div class="fighter player">
        <h3>You</h3>
        <div class="hp-bar"><div class="hp-fill" id="std-player-hp-bar" style="width:100%"></div></div>
        <div class="hp-text" id="std-player-hp-text">HP: 5/5</div>
      </div>
      <div class="fighter enemy" style="margin-top:0.5rem">
        <h3>Opponent</h3>
        <div class="hp-bar"><div class="hp-fill" id="std-enemy-hp-bar" style="width:100%"></div></div>
        <div class="hp-text" id="std-enemy-hp-text">HP: 5/5</div>
      </div>
      <div class="battle-log" id="std-log">
        <div class="log-entry system">Each turn: 1/3 chance you hit, 1/3 both hit, 1/3 they hit.</div>
      </div>
      <div class="action-buttons">
        <button class="btn btn-fight" id="std-fight-btn" onclick="stdFight()">Fight!</button>
        <button class="btn btn-reset" onclick="stdReset()">Reset</button>
      </div>
      <div class="state-indicator" id="std-state">State: HP(5,5)</div>
    </div>

    <!-- Enhanced Battle -->
    <div id="game-enhanced">
      <div class="game-title" style="color:#ff8c00">Enhanced Battle</div>
      <div class="fighter player">
        <h3>You</h3>
        <div class="hp-bar"><div class="hp-fill" id="enh-player-hp-bar" style="width:100%"></div></div>
        <div class="hp-text" id="enh-player-hp-text">HP: 5/5</div>
        <div class="rage-bar"><div class="rage-fill" id="enh-player-rage-bar" style="width:0%"></div></div>
        <div class="rage-text" id="enh-player-rage-text">Rage: 0</div>
      </div>
      <div class="fighter enemy" style="margin-top:0.5rem">
        <h3>Opponent</h3>
        <div class="hp-bar"><div class="hp-fill" id="enh-enemy-hp-bar" style="width:100%"></div></div>
        <div class="hp-text" id="enh-enemy-hp-text">HP: 5/5</div>
        <div class="rage-bar"><div class="rage-fill" id="enh-enemy-rage-bar" style="width:0%"></div></div>
        <div class="rage-text" id="enh-enemy-rage-text">Rage: 0</div>
      </div>
      <div class="battle-log" id="enh-log">
        <div class="log-entry system">Same odds + 10% crit chance. Crits deal 1 + rage damage. Rage builds from combat.</div>
      </div>
      <div class="action-buttons">
        <button class="btn btn-fight" id="enh-fight-btn" onclick="enhFight()" style="background:linear-gradient(135deg,#a54a00,#ff8c00)">Fight!</button>
        <button class="btn btn-reset" onclick="enhReset()">Reset</button>
      </div>
      <div class="state-indicator" id="enh-state">State: HP(5,5) R(0,0)</div>
    </div>
  </div>

  <!-- Analysis -->
  <div class="analysis-panel" id="battle-analysis">
    <h3>ToA Analysis: Why Does One Feel Better?</h3>
    <div class="gds-display">
      <div class="gds-card">
        <div class="label">Standard Battle</div>
        <div class="value">0.437</div>
        <div class="sub">GDS (Game Design Score)</div>
      </div>
      <div class="gds-card">
        <div class="label">Enhanced Battle</div>
        <div class="value highlight">0.560</div>
        <div class="sub">GDS (+28% higher)</div>
      </div>
    </div>

    <div style="display:flex;gap:1.5rem;justify-content:center;margin:1rem 0;flex-wrap:wrap">
      <div style="text-align:center">
        <div style="font-size:0.75rem;color:#888;margin-bottom:0.3rem">Standard — GDS Breakdown</div>
        <div style="display:flex;align-items:flex-end;gap:4px;height:80px;justify-content:center">
          <div style="display:flex;flex-direction:column;align-items:center">
            <div class="bar a1" style="width:28px;height:52px"></div>
            <span class="bar-label">A&#x2081;</span>
          </div>
          <div style="display:flex;flex-direction:column;align-items:center">
            <div class="bar a2" style="width:28px;height:40px"></div>
            <span class="bar-label">A&#x2082;</span>
          </div>
          <div style="display:flex;flex-direction:column;align-items:center">
            <div class="bar a3" style="width:28px;height:21px"></div>
            <span class="bar-label">A&#x2083;</span>
          </div>
          <div style="display:flex;flex-direction:column;align-items:center">
            <div class="bar a3" style="width:28px;height:10px"></div>
            <span class="bar-label">A&#x2084;+</span>
          </div>
        </div>
        <div style="font-size:0.7rem;color:#666;margin-top:0.3rem">Depth: 59.6%</div>
      </div>
      <div style="text-align:center">
        <div style="font-size:0.75rem;color:#888;margin-bottom:0.3rem">Enhanced — GDS Breakdown</div>
        <div style="display:flex;align-items:flex-end;gap:4px;height:80px;justify-content:center">
          <div style="display:flex;flex-direction:column;align-items:center">
            <div class="bar a1" style="width:28px;height:47px"></div>
            <span class="bar-label">A&#x2081;</span>
          </div>
          <div style="display:flex;flex-direction:column;align-items:center">
            <div class="bar a2" style="width:28px;height:37px"></div>
            <span class="bar-label">A&#x2082;</span>
          </div>
          <div style="display:flex;flex-direction:column;align-items:center">
            <div class="bar a3" style="width:28px;height:25px"></div>
            <span class="bar-label">A&#x2083;</span>
          </div>
          <div style="display:flex;flex-direction:column;align-items:center">
            <div class="bar a3" style="width:28px;height:18px"></div>
            <span class="bar-label">A&#x2084;+</span>
          </div>
        </div>
        <div style="font-size:0.7rem;color:#666;margin-top:0.3rem">Depth: 64.5%</div>
      </div>
    </div>

    <div class="explanation">
      <strong>A&#x2081;</strong> = immediate excitement (will this turn go well?).<br>
      <strong>A&#x2082;</strong> = strategic awareness (how does this turn affect future turns?).<br>
      <strong>A&#x2083;+</strong> = deep structure (cascading implications across many turns).<br><br>
      The Enhanced version scores higher because <strong>rage mechanics create comeback potential</strong>. When you're losing, your rage builds, making future crits more devastating. This means every hit matters more &mdash; not just for this turn, but for the shape of the entire fight. That's why it <em>feels</em> more exciting even though the base odds are the same.
    </div>
  </div>
</div>

<!-- ============ SLOTS TAB ============ -->
<div id="tab-slots" class="game-container">

  <div class="comparison">
    <!-- Slot Machine -->
    <div>
      <div class="game-title">Slot Machine</div>
      <div class="slot-area">
        <div class="slot-display">
          <div class="slot-reel" id="reel1">?</div>
          <div class="slot-reel" id="reel2">?</div>
          <div class="slot-reel" id="reel3">?</div>
        </div>
        <div class="slot-result" id="slot-result">&nbsp;</div>
        <div class="slot-stats">
          <div class="slot-stat">
            <div>Balance</div>
            <div class="val" id="slot-balance">100</div>
          </div>
          <div class="slot-stat">
            <div>Spins</div>
            <div class="val" id="slot-spins">0</div>
          </div>
          <div class="slot-stat">
            <div>Best</div>
            <div class="val" id="slot-best">0</div>
          </div>
        </div>
        <div class="action-buttons">
          <button class="btn btn-fight" id="slot-spin-btn" onclick="slotSpin()" style="background:linear-gradient(135deg,#7b2d8b,#c850c0)">Spin! (-10)</button>
          <button class="btn btn-reset" onclick="slotReset()">Reset</button>
        </div>
      </div>
    </div>

    <!-- Coin Flip Game -->
    <div>
      <div class="game-title" style="color:#4ecdc4">Double or Nothing</div>
      <div class="slot-area">
        <div class="slot-display">
          <div class="slot-reel" id="coin-display" style="font-size:3rem;width:90px;height:90px">&#x1FA99;</div>
        </div>
        <div class="slot-result" id="coin-result">&nbsp;</div>
        <div class="slot-stats">
          <div class="slot-stat">
            <div>At Stake</div>
            <div class="val" id="coin-stake">10</div>
          </div>
          <div class="slot-stat">
            <div>Round</div>
            <div class="val" id="coin-round">1</div>
          </div>
          <div class="slot-stat">
            <div>Max Won</div>
            <div class="val" id="coin-best">0</div>
          </div>
        </div>
        <div class="action-buttons">
          <button class="btn btn-fight" id="coin-flip-btn" onclick="coinFlip()" style="background:linear-gradient(135deg,#2d7b5b,#4ecdc4)">Flip!</button>
          <button class="btn btn-fight" id="coin-take-btn" onclick="coinTake()" style="background:linear-gradient(135deg,#5b5b2d,#cdcd4e);display:none">Take Winnings</button>
          <button class="btn btn-reset" onclick="coinReset()">Reset</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Analysis -->
  <div class="analysis-panel">
    <h3>ToA Analysis: Gambling vs Games</h3>
    <div class="gds-display">
      <div class="gds-card">
        <div class="label">Slot Machine</div>
        <div class="value">0.102</div>
        <div class="sub">GDS (one spin)</div>
      </div>
      <div class="gds-card">
        <div class="label">Double or Nothing</div>
        <div class="value highlight">0.500</div>
        <div class="sub">GDS (per flip)</div>
      </div>
    </div>
    <div class="explanation">
      The slot machine has <strong>5x lower</strong> engagement per spin than a simple coin flip. Why?<br><br>
      <strong>Payout asymmetry</strong>: the slot has a 0.1% jackpot and 62.9% loss. Most of the time, you know you'll lose.
      The anticipation formula A&#x2081; = &radic;(p&middot;(1-p)) is maximized at p = 50%, and drops sharply for extreme probabilities.<br><br>
      Casinos trade engagement for revenue. The <strong>house edge</strong> (reducing your win chance by a few percent) barely affects GDS (&lt;1%). What kills engagement is the <strong>skewed payout structure</strong> &mdash; rare jackpots + frequent losses = low uncertainty = low anticipation.<br><br>
      The coin flip feels more exciting because <em>you genuinely don't know what will happen next</em>.
    </div>
  </div>
</div>

<div class="footer">
  <a href="{{ '/toa-research/' | relative_url }}">Theory of Anticipation Research</a> &middot;
  Built with data from 100 verified tests
</div>

<script>
// ============================================================
// Standard Battle
// ============================================================
const STD_MAX_HP = 5;
let stdState = { hp1: 5, hp2: 5, over: false, wins: 0, losses: 0 };

function stdFight() {
  if (stdState.over) return;
  const roll = Math.random();
  let msg = '';

  if (roll < 1/3) {
    stdState.hp2--;
    msg = '<span class="hit">You attack!</span> Opponent takes 1 damage.';
  } else if (roll < 2/3) {
    stdState.hp1--;
    stdState.hp2--;
    msg = 'Both attack! Both take 1 damage.';
  } else {
    stdState.hp1--;
    msg = '<span class="damage">Opponent attacks!</span> You take 1 damage.';
  }

  stdState.hp1 = Math.max(0, stdState.hp1);
  stdState.hp2 = Math.max(0, stdState.hp2);
  stdUpdateUI(msg);

  if (stdState.hp1 <= 0 || stdState.hp2 <= 0) {
    stdState.over = true;
    document.getElementById('std-fight-btn').disabled = true;
    if (stdState.hp1 > 0 && stdState.hp2 <= 0) {
      stdLog('<span class="hit"><strong>Victory!</strong></span>');
      stdState.wins++;
    } else if (stdState.hp2 > 0 && stdState.hp1 <= 0) {
      stdLog('<span class="damage"><strong>Defeat.</strong></span>');
      stdState.losses++;
    } else {
      stdLog('<span class="system"><strong>Mutual destruction!</strong></span>');
    }
  }
}

function stdUpdateUI(logMsg) {
  const pBar = document.getElementById('std-player-hp-bar');
  const eBar = document.getElementById('std-enemy-hp-bar');
  pBar.style.width = (stdState.hp1 / STD_MAX_HP * 100) + '%';
  eBar.style.width = (stdState.hp2 / STD_MAX_HP * 100) + '%';
  document.getElementById('std-player-hp-text').textContent = `HP: ${stdState.hp1}/${STD_MAX_HP}`;
  document.getElementById('std-enemy-hp-text').textContent = `HP: ${stdState.hp2}/${STD_MAX_HP}`;
  document.getElementById('std-state').textContent = `State: HP(${stdState.hp1},${stdState.hp2})`;
  if (logMsg) stdLog(logMsg);
}

function stdLog(msg) {
  const log = document.getElementById('std-log');
  log.innerHTML += `<div class="log-entry">${msg}</div>`;
  log.scrollTop = log.scrollHeight;
}

function stdReset() {
  stdState = { hp1: 5, hp2: 5, over: false };
  document.getElementById('std-fight-btn').disabled = false;
  document.getElementById('std-log').innerHTML = '<div class="log-entry system">Each turn: 1/3 chance you hit, 1/3 both hit, 1/3 they hit.</div>';
  stdUpdateUI();
}

// ============================================================
// Enhanced Battle (with Rage/Crit)
// ============================================================
const ENH_MAX_HP = 5;
const ENH_MAX_RAGE = 5;
const CRIT_CHANCE = 0.10;
let enhState = { hp1: 5, hp2: 5, rage1: 0, rage2: 0, over: false };

function enhFight() {
  if (enhState.over) return;
  const roll = Math.random();
  let msg = '';

  const hitChance = (1.0 - CRIT_CHANCE) / 2.0;
  const missChance = hitChance;

  // Determine P1 and P2 actions
  const r1 = Math.random();
  const r2 = Math.random();

  let p1Action, p2Action;
  if (r1 < CRIT_CHANCE) p1Action = 'crit';
  else if (r1 < CRIT_CHANCE + hitChance) p1Action = 'hit';
  else p1Action = 'miss';

  if (r2 < CRIT_CHANCE) p2Action = 'crit';
  else if (r2 < CRIT_CHANCE + hitChance) p2Action = 'hit';
  else p2Action = 'miss';

  // Calculate damage
  let p1Dmg = 0, p2Dmg = 0;
  let p1Msg = '', p2Msg = '';

  if (p1Action === 'crit') {
    p1Dmg = 1 + enhState.rage1;
    p1Msg = `<span class="crit">CRITICAL HIT! (${p1Dmg} dmg)</span>`;
  } else if (p1Action === 'hit') {
    p1Dmg = 1;
    p1Msg = '<span class="hit">You attack! (1 dmg)</span>';
  } else {
    p1Msg = 'You miss.';
  }

  if (p2Action === 'crit') {
    p2Dmg = 1 + enhState.rage2;
    p2Msg = `<span class="crit">Enemy CRITICAL! (${p2Dmg} dmg)</span>`;
  } else if (p2Action === 'hit') {
    p2Dmg = 1;
    p2Msg = '<span class="damage">Enemy attacks! (1 dmg)</span>';
  } else {
    p2Msg = 'Enemy misses.';
  }

  // Apply damage
  enhState.hp2 = Math.max(0, enhState.hp2 - p1Dmg);
  enhState.hp1 = Math.max(0, enhState.hp1 - p2Dmg);

  // Update rage
  if (p1Dmg > 0) enhState.rage1 = Math.min(ENH_MAX_RAGE, enhState.rage1 + 1);
  if (p2Dmg > 0) enhState.rage1 = Math.min(ENH_MAX_RAGE, enhState.rage1 + 1);
  if (p2Dmg > 0) enhState.rage2 = Math.min(ENH_MAX_RAGE, enhState.rage2 + 1);
  if (p1Dmg > 0) enhState.rage2 = Math.min(ENH_MAX_RAGE, enhState.rage2 + 1);

  msg = `${p1Msg} ${p2Msg}`;
  enhUpdateUI(msg);

  if (enhState.hp1 <= 0 || enhState.hp2 <= 0) {
    enhState.over = true;
    document.getElementById('enh-fight-btn').disabled = true;
    if (enhState.hp1 > 0 && enhState.hp2 <= 0) {
      enhLog('<span class="hit"><strong>Victory!</strong></span>');
    } else if (enhState.hp2 > 0 && enhState.hp1 <= 0) {
      enhLog('<span class="damage"><strong>Defeat.</strong></span>');
    } else {
      enhLog('<span class="system"><strong>Mutual destruction!</strong></span>');
    }
  }
}

function enhUpdateUI(logMsg) {
  document.getElementById('enh-player-hp-bar').style.width = (enhState.hp1 / ENH_MAX_HP * 100) + '%';
  document.getElementById('enh-enemy-hp-bar').style.width = (enhState.hp2 / ENH_MAX_HP * 100) + '%';
  document.getElementById('enh-player-hp-text').textContent = `HP: ${enhState.hp1}/${ENH_MAX_HP}`;
  document.getElementById('enh-enemy-hp-text').textContent = `HP: ${enhState.hp2}/${ENH_MAX_HP}`;
  document.getElementById('enh-player-rage-bar').style.width = (enhState.rage1 / ENH_MAX_RAGE * 100) + '%';
  document.getElementById('enh-enemy-rage-bar').style.width = (enhState.rage2 / ENH_MAX_RAGE * 100) + '%';
  document.getElementById('enh-player-rage-text').textContent = `Rage: ${enhState.rage1}`;
  document.getElementById('enh-enemy-rage-text').textContent = `Rage: ${enhState.rage2}`;
  document.getElementById('enh-state').textContent = `State: HP(${enhState.hp1},${enhState.hp2}) R(${enhState.rage1},${enhState.rage2})`;
  if (logMsg) enhLog(logMsg);
}

function enhLog(msg) {
  const log = document.getElementById('enh-log');
  log.innerHTML += `<div class="log-entry">${msg}</div>`;
  log.scrollTop = log.scrollHeight;
}

function enhReset() {
  enhState = { hp1: 5, hp2: 5, rage1: 0, rage2: 0, over: false };
  document.getElementById('enh-fight-btn').disabled = false;
  document.getElementById('enh-log').innerHTML = '<div class="log-entry system">Same odds + 10% crit chance. Crits deal 1 + rage damage. Rage builds from combat.</div>';
  enhUpdateUI();
}

// ============================================================
// Slot Machine
// ============================================================
const SLOT_SYMBOLS = ['&#x1F352;','&#x1F34B;','&#x1F514;','&#x2B50;','&#x1F48E;','7&#xFE0F;&#x20E3;'];
let slotState = { balance: 100, spins: 0, best: 0, spinning: false };

function slotSpin() {
  if (slotState.spinning || slotState.balance < 10) return;
  slotState.spinning = true;
  slotState.balance -= 10;
  slotState.spins++;
  document.getElementById('slot-spin-btn').disabled = true;
  document.getElementById('slot-result').innerHTML = '&nbsp;';

  const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
  reels.forEach(r => r.classList.add('spinning'));

  // Determine result
  const roll = Math.random();
  let result, symbols, payout;

  if (roll < 0.001) {
    result = 'JACKPOT!';
    symbols = ['7&#xFE0F;&#x20E3;','7&#xFE0F;&#x20E3;','7&#xFE0F;&#x20E3;'];
    payout = 1000;
  } else if (roll < 0.021) {
    result = 'Big Win!';
    const s = SLOT_SYMBOLS[Math.floor(Math.random() * 4)];
    symbols = [s, s, s];
    payout = 100;
  } else if (roll < 0.171) {
    result = 'Small Win';
    const s = SLOT_SYMBOLS[Math.floor(Math.random() * 4)];
    symbols = [s, s, SLOT_SYMBOLS[Math.floor(Math.random() * SLOT_SYMBOLS.length)]];
    payout = 20;
  } else if (roll < 0.371) {
    result = 'So close...';
    const s = SLOT_SYMBOLS[Math.floor(Math.random() * 4)];
    const other = SLOT_SYMBOLS[(SLOT_SYMBOLS.indexOf(s) + 1) % SLOT_SYMBOLS.length];
    symbols = [s, s, other];
    payout = 0;
  } else {
    result = '';
    symbols = [
      SLOT_SYMBOLS[Math.floor(Math.random() * SLOT_SYMBOLS.length)],
      SLOT_SYMBOLS[Math.floor(Math.random() * SLOT_SYMBOLS.length)],
      SLOT_SYMBOLS[Math.floor(Math.random() * SLOT_SYMBOLS.length)],
    ];
    payout = 0;
  }

  // Animate reels stopping one by one
  setTimeout(() => { reels[0].classList.remove('spinning'); reels[0].innerHTML = symbols[0]; }, 300);
  setTimeout(() => { reels[1].classList.remove('spinning'); reels[1].innerHTML = symbols[1]; }, 600);
  setTimeout(() => {
    reels[2].classList.remove('spinning');
    reels[2].innerHTML = symbols[2];

    slotState.balance += payout;
    slotState.best = Math.max(slotState.best, payout);
    slotState.spinning = false;

    if (payout > 0) {
      document.getElementById('slot-result').innerHTML = `<span class="win">${result} +${payout}</span>`;
      reels.forEach(r => r.classList.add('win'));
      setTimeout(() => reels.forEach(r => r.classList.remove('win')), 1000);
    } else if (result) {
      document.getElementById('slot-result').innerHTML = `<span class="lose">${result}</span>`;
    } else {
      document.getElementById('slot-result').innerHTML = `<span class="lose">No match</span>`;
    }

    document.getElementById('slot-balance').textContent = slotState.balance;
    document.getElementById('slot-spins').textContent = slotState.spins;
    document.getElementById('slot-best').textContent = slotState.best;
    document.getElementById('slot-spin-btn').disabled = slotState.balance < 10;

    if (slotState.balance < 10) {
      document.getElementById('slot-result').innerHTML = '<span class="lose">Bankrupt!</span>';
    }
  }, 900);
}

function slotReset() {
  slotState = { balance: 100, spins: 0, best: 0, spinning: false };
  document.getElementById('slot-balance').textContent = 100;
  document.getElementById('slot-spins').textContent = 0;
  document.getElementById('slot-best').textContent = 0;
  document.getElementById('slot-result').innerHTML = '&nbsp;';
  document.getElementById('slot-spin-btn').disabled = false;
  ['reel1','reel2','reel3'].forEach(id => {
    const el = document.getElementById(id);
    el.innerHTML = '?';
    el.classList.remove('spinning', 'win');
  });
}

// ============================================================
// Coin Flip (Double or Nothing)
// ============================================================
let coinState = { stake: 10, round: 1, best: 0, active: true, totalWon: 0 };

function coinFlip() {
  if (!coinState.active) return;
  const win = Math.random() < 0.5;
  const display = document.getElementById('coin-display');

  display.classList.add('spinning');
  setTimeout(() => {
    display.classList.remove('spinning');
    if (win) {
      coinState.stake *= 2;
      coinState.round++;
      display.innerHTML = '&#x2705;';
      document.getElementById('coin-result').innerHTML = `<span class="win">Heads! Stake doubled to ${coinState.stake}</span>`;
      document.getElementById('coin-take-btn').style.display = 'inline-block';
    } else {
      display.innerHTML = '&#x274C;';
      document.getElementById('coin-result').innerHTML = `<span class="lose">Tails! Lost ${coinState.stake}</span>`;
      coinState.stake = 0;
      coinState.active = false;
      document.getElementById('coin-flip-btn').disabled = true;
      document.getElementById('coin-take-btn').style.display = 'none';
    }
    document.getElementById('coin-stake').textContent = coinState.stake;
    document.getElementById('coin-round').textContent = coinState.round;
    document.getElementById('coin-best').textContent = coinState.best;
  }, 400);
}

function coinTake() {
  coinState.totalWon += coinState.stake;
  coinState.best = Math.max(coinState.best, coinState.stake);
  document.getElementById('coin-result').innerHTML = `<span class="win">Took ${coinState.stake}! Starting new round.</span>`;
  document.getElementById('coin-best').textContent = coinState.best;
  coinState.stake = 10;
  coinState.round = 1;
  document.getElementById('coin-stake').textContent = coinState.stake;
  document.getElementById('coin-round').textContent = coinState.round;
  document.getElementById('coin-display').innerHTML = '&#x1FA99;';
  document.getElementById('coin-take-btn').style.display = 'none';
}

function coinReset() {
  coinState = { stake: 10, round: 1, best: 0, active: true, totalWon: 0 };
  document.getElementById('coin-stake').textContent = 10;
  document.getElementById('coin-round').textContent = 1;
  document.getElementById('coin-best').textContent = 0;
  document.getElementById('coin-result').innerHTML = '&nbsp;';
  document.getElementById('coin-display').innerHTML = '&#x1FA99;';
  document.getElementById('coin-flip-btn').disabled = false;
  document.getElementById('coin-take-btn').style.display = 'none';
}

// ============================================================
// Tab switching
// ============================================================
function switchTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.game-container').forEach(c => c.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('tab-' + tab).classList.add('active');
}
</script>

</body>
</html>
